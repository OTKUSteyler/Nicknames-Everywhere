(function(p,i,m,O,t,e,T,z,C,V){"use strict";const{ScrollView:J,View:N,Text:b,TouchableOpacity:L,TextInput:G}=e.ReactNative,{FormRow:l,FormSwitch:S,FormInput:M,FormDivider:P,FormSection:R,FormText:H}=V.Forms;t.storage.nicknames||(t.storage.nicknames={}),t.storage.settings||(t.storage.settings={enabled:!0,showPrefix:!1,prefix:"[",suffix:"]",overrideServerNicks:!0});let w=[],v=null,x=null,E=null,c=null,k=null;function U(r){if(!t.storage.settings.enabled||!r)return null;const a=t.storage.nicknames[r];return a?t.storage.settings.showPrefix?t.storage.settings.prefix+a+t.storage.settings.suffix:a:null}function A(r,a){!a||a.trim()===""?delete t.storage.nicknames[r]:t.storage.nicknames[r]=a.trim()}function g(r,a=1){const s=m.findByProps("showToast");s?.showToast&&s.showToast(r,a)}function $(r,a){const s=t.storage.nicknames[r]||"";T.showInputAlert({title:"Set Custom Nickname",placeholder:a,initialValue:s,confirmText:"Save",cancelText:"Cancel",onConfirm:function(f){A(r,f),f.trim()?g(`Nickname set to "${f}"`):g("Nickname removed")}})}function W(){try{if(c=m.findByProps("getUser","getCurrentUser"),!c){i.logger.warn("[NicknamesEverywhere] UserUtils module not found");return}c.getName&&(v=c.getName,c.getName=function(...r){const a=r[0];if(a?.id){const s=U(a.id);if(s)return s}return v.apply(this,r)}),c.getDisplayName&&(x=c.getDisplayName,c.getDisplayName=function(...r){const a=r[0];if(a?.id){const s=U(a.id);if(s)return s}return x.apply(this,r)}),i.logger.log("[NicknamesEverywhere] UserUtils patched (getName, getDisplayName)")}catch(r){i.logger.error("[NicknamesEverywhere] Error patching UserUtils:",r)}}function j(){try{if(k=m.findByProps("getNick","getMember"),!k||!k.getNick){i.logger.warn("[NicknamesEverywhere] GuildMemberStore.getNick not found");return}if(!t.storage.settings.overrideServerNicks){i.logger.log("[NicknamesEverywhere] Server nickname override disabled");return}E=k.getNick,k.getNick=function(...r){const a=r[1];if(a){const s=U(a);if(s)return s}return E.apply(this,r)},i.logger.log("[NicknamesEverywhere] GuildMemberStore.getNick patched")}catch(r){i.logger.error("[NicknamesEverywhere] Error patching GuildMemberStore:",r)}}function Y(){try{const r=[m.findByProps("openUserContextMenu"),m.findByProps("showUserActionSheet"),m.findByProps("openContextMenuLazy"),m.findByProps("openUserContextMenuForUser")].filter(Boolean);if(r.length===0){i.logger.warn("[NicknamesEverywhere] No user action modules found");return}let a=!1;for(const s of r){if(typeof s.openUserContextMenu=="function")try{const y=O.before("openUserContextMenu",s,function(n){});w.push(y),a=!0}catch{}const f=["getUserActions","getActions","buildUserContextMenuItems","getUserContextMenuItems"];for(const y of f)if(typeof s[y]=="function")try{const n=O.after(y,s,function(o,u){if(!Array.isArray(u))return u;const h=o[0]?.user||o[0]?.userId||o[0];let d=null;if(typeof h=="string"?d=h:h?.id&&(d=h.id),!d)return u;const F=t.storage.nicknames[d],Q=h?.globalName||h?.username||"User";let B=u.findIndex(function(D){return D?.label?.includes("Block")||D?.key==="block"||D?.label?.includes("Ignore")});B===-1&&(B=u.length);const I=[];return I.push({key:"set-custom-nickname",label:F?"Edit Custom Nickname":"Set Custom Nickname",icon:"ic_edit",onPress:function(){return $(d,Q)}}),F&&I.push({key:"remove-custom-nickname",label:"Remove Custom Nickname",icon:"ic_message_delete",destructive:!0,onPress:function(){A(d,""),g("Custom nickname removed")}}),u.splice(B,0,...I),u});w.push(n),a=!0,i.logger.log(`[NicknamesEverywhere] Patched ${y}`)}catch{}}a||i.logger.warn("[NicknamesEverywhere] Could not patch user action menu")}catch(r){i.logger.error("[NicknamesEverywhere] Error patching user actions:",r)}}function q(){z.useProxy(t.storage);const r=m.findByStoreName("UserStore"),[a,s]=e.React.useState(""),f=function(n){try{const o=r?.getUser(n);return o?o.username:n}catch{return n}},y=Object.entries(t.storage.nicknames).filter(function([n,o]){if(!a)return!0;const u=f(n).toLowerCase(),h=o.toLowerCase(),d=a.toLowerCase();return u.includes(d)||h.includes(d)});return e.React.createElement(J,{style:{flex:1}},e.React.createElement(R,{title:"General Settings"},e.React.createElement(l,{label:"Enable Nicknames",subLabel:"Toggle all nickname functionality",trailing:e.React.createElement(S,{value:t.storage.settings.enabled,onValueChange:function(n){t.storage.settings.enabled=n}})}),e.React.createElement(l,{label:"Override Server Nicknames",subLabel:"Use custom nicknames instead of server ones",trailing:e.React.createElement(S,{value:t.storage.settings.overrideServerNicks,onValueChange:function(n){t.storage.settings.overrideServerNicks=n,n&&!E&&j()}})})),e.React.createElement(P,null),e.React.createElement(R,{title:"Display Options"},e.React.createElement(l,{label:"Show Prefix/Suffix",subLabel:"Add decorative text around nicknames",trailing:e.React.createElement(S,{value:t.storage.settings.showPrefix,onValueChange:function(n){t.storage.settings.showPrefix=n}})}),t.storage.settings.showPrefix&&e.React.createElement(M,{label:"Prefix",placeholder:"[",value:t.storage.settings.prefix,onChange:function(n){t.storage.settings.prefix=n}}),t.storage.settings.showPrefix&&e.React.createElement(M,{label:"Suffix",placeholder:"]",value:t.storage.settings.suffix,onChange:function(n){t.storage.settings.suffix=n}}),t.storage.settings.showPrefix&&e.React.createElement(N,{style:{padding:16,backgroundColor:"#2b2d31",marginHorizontal:16,marginTop:8,borderRadius:8}},e.React.createElement(b,{style:{color:"#b5bac1",fontSize:13}},`Preview: ${t.storage.settings.prefix}YourNickname${t.storage.settings.suffix}`))),e.React.createElement(P,null),e.React.createElement(R,{title:`Saved Nicknames (${Object.keys(t.storage.nicknames).length})`},e.React.createElement(H,null,"Long-press any user to set a nickname"),e.React.createElement(N,{style:{padding:16}},e.React.createElement(G,{placeholder:"Search nicknames...",placeholderTextColor:"#666",value:a,onChangeText:s,style:{backgroundColor:"#1e1f22",color:"#fff",padding:12,borderRadius:8,marginBottom:12}}),y.length===0?e.React.createElement(N,{style:{padding:20,alignItems:"center"}},e.React.createElement(b,{style:{color:"#888",textAlign:"center"}},a?"No nicknames found":"No nicknames saved yet")):y.map(function([n,o]){return e.React.createElement(N,{key:n,style:{backgroundColor:"#2b2d31",padding:12,borderRadius:8,marginBottom:8}},e.React.createElement(b,{style:{color:"#fff",fontWeight:"bold",marginBottom:4}},o),e.React.createElement(b,{style:{color:"#888",fontSize:12,marginBottom:8}},f(n)),e.React.createElement(N,{style:{flexDirection:"row",gap:8}},e.React.createElement(L,{style:{backgroundColor:"#5865f2",padding:8,borderRadius:6,flex:1},onPress:function(){return $(n,f(n))}},e.React.createElement(b,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:"600"}},"Edit")),e.React.createElement(L,{style:{backgroundColor:"#ed4245",padding:8,borderRadius:6,flex:1},onPress:function(){A(n,""),g("Nickname removed")}},e.React.createElement(b,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:"600"}},"Delete"))))}))),e.React.createElement(P,null),e.React.createElement(R,{title:"Data Management"},e.React.createElement(l,{label:"Export Nicknames",subLabel:"Copy to clipboard as JSON",leading:e.React.createElement(l.Icon,{source:C.getAssetIDByName("ic_download_24px")}),onPress:function(){const n=JSON.stringify(t.storage.nicknames,null,2);e.ReactNative.Clipboard?.setString(n),g(`Exported ${Object.keys(t.storage.nicknames).length} nicknames`)}}),e.React.createElement(l,{label:"Import Nicknames",subLabel:"Paste JSON from clipboard",leading:e.React.createElement(l.Icon,{source:C.getAssetIDByName("ic_upload_24px")}),onPress:async function(){try{const n=await e.ReactNative.Clipboard?.getString();if(!n){g("Clipboard is empty",2);return}const o=JSON.parse(n);Object.assign(t.storage.nicknames,o),g(`Imported ${Object.keys(o).length} nicknames`)}catch{g("Invalid JSON format",2)}}}),e.React.createElement(l,{label:"Clear All Nicknames",subLabel:"Delete all saved nicknames",leading:e.React.createElement(l.Icon,{source:C.getAssetIDByName("ic_message_delete")}),onPress:function(){T.showConfirmationAlert({title:"Clear All Nicknames?",content:`Delete all ${Object.keys(t.storage.nicknames).length} saved nicknames?`,confirmText:"Delete All",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){const n=Object.keys(t.storage.nicknames).length;t.storage.nicknames={},g(`Cleared ${n} nicknames`)}})}})),e.React.createElement(N,{style:{padding:16,marginBottom:20}},e.React.createElement(b,{style:{color:"#b5bac1",fontSize:12,textAlign:"center",lineHeight:18}},`Nicknames Everywhere v1.0
Custom nicknames across all servers and DMs`)))}var K={onLoad:function(){try{W(),j(),Y(),i.logger.log(`[NicknamesEverywhere] Loaded with ${Object.keys(t.storage.nicknames).length} nicknames`)}catch(r){i.logger.error("[NicknamesEverywhere] Load error:",r)}},onUnload:function(){c&&(v&&(c.getName=v,v=null),x&&(c.getDisplayName=x,x=null),c=null),k&&E&&(k.getNick=E,E=null,k=null),w.forEach(function(r){try{r()}catch(a){i.logger.error("[NicknamesEverywhere] Unpatch error:",a)}}),w=[],i.logger.log("[NicknamesEverywhere] Unloaded. All patches restored.")},settings:q};return p.default=K,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.alerts,vendetta.storage,vendetta.ui.assets,vendetta.ui.components);
