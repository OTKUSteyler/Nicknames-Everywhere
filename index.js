(function(x,c,k,I,t,e,D,L,p,$){"use strict";const{ScrollView:j,View:y,Text:m,TouchableOpacity:O,TextInput:M}=e.ReactNative,{FormRow:g,FormSwitch:S,FormInput:F,FormDivider:C,FormSection:b,FormText:z}=$.Forms;t.storage.nicknames||(t.storage.nicknames={}),t.storage.settings||(t.storage.settings={enabled:!0,showPrefix:!1,prefix:"[",suffix:"]",overrideServerNicks:!0});let P=[],N=null,E=null,h=null,o=null,d=null;function A(r){if(!t.storage.settings.enabled||!r)return null;const n=t.storage.nicknames[r];return n?t.storage.settings.showPrefix?t.storage.settings.prefix+n+t.storage.settings.suffix:n:null}function U(r,n){!n||n.trim()===""?delete t.storage.nicknames[r]:t.storage.nicknames[r]=n.trim()}function f(r,n=1){const s=k.findByProps("showToast");s?.showToast&&s.showToast(r,n)}function B(r,n){const s=t.storage.nicknames[r]||"";D.showInputAlert({title:"Set Custom Nickname",placeholder:n,initialValue:s,confirmText:"Save",cancelText:"Cancel",onConfirm:function(l){U(r,l),l.trim()?f(`Nickname set to "${l}"`):f("Nickname removed")}})}function V(){try{if(o=k.findByProps("getUser","getCurrentUser"),!o){c.logger.warn("[NicknamesEverywhere] UserUtils module not found");return}o.getName&&(N=o.getName,o.getName=function(...r){const n=r[0];if(n?.id){const s=A(n.id);if(s)return s}return N.apply(this,r)}),o.getDisplayName&&(E=o.getDisplayName,o.getDisplayName=function(...r){const n=r[0];if(n?.id){const s=A(n.id);if(s)return s}return E.apply(this,r)}),c.logger.log("[NicknamesEverywhere] UserUtils patched (getName, getDisplayName)")}catch(r){c.logger.error("[NicknamesEverywhere] Error patching UserUtils:",r)}}function T(){try{if(d=k.findByProps("getNick","getMember"),!d||!d.getNick){c.logger.warn("[NicknamesEverywhere] GuildMemberStore.getNick not found");return}if(!t.storage.settings.overrideServerNicks){c.logger.log("[NicknamesEverywhere] Server nickname override disabled");return}h=d.getNick,d.getNick=function(...r){const n=r[1];if(n){const s=A(n);if(s)return s}return h.apply(this,r)},c.logger.log("[NicknamesEverywhere] GuildMemberStore.getNick patched")}catch(r){c.logger.error("[NicknamesEverywhere] Error patching GuildMemberStore:",r)}}function J(){try{const r=[k.findByProps("openUserContextMenu"),k.findByProps("showUserActionSheet"),k.findByProps("getUserActions")].filter(Boolean);if(r.length===0){c.logger.warn("[NicknamesEverywhere] No user action modules found");return}for(const n of r){const s=["getUserActions","getActions","buildActions"];for(const l of s)if(typeof n[l]=="function")try{const v=I.after(l,n,function(a,i){if(!Array.isArray(i))return i;const u=a[0]?.user||a[0];if(!u?.id)return i;const R=t.storage.nicknames[u.id],w=u.globalName||u.username||"User";return i.push({key:"set-nickname",label:R?"\u270F\uFE0F Edit Nickname":"\u270F\uFE0F Set Nickname",icon:"ic_edit",onPress:function(){return B(u.id,w)}}),R&&i.push({key:"remove-nickname",label:"\u{1F5D1}\uFE0F Remove Nickname",icon:"ic_message_delete",destructive:!0,onPress:function(){U(u.id,""),f("Nickname removed")}}),i});P.push(v),c.logger.log(`[NicknamesEverywhere] Patched ${l} in user actions`)}catch{}}}catch(r){c.logger.error("[NicknamesEverywhere] Error patching user actions:",r)}}function G(){L.useProxy(t.storage);const r=k.findByStoreName("UserStore"),[n,s]=e.React.useState(""),l=function(a){try{const i=r?.getUser(a);return i?i.username:a}catch{return a}},v=Object.entries(t.storage.nicknames).filter(function([a,i]){if(!n)return!0;const u=l(a).toLowerCase(),R=i.toLowerCase(),w=n.toLowerCase();return u.includes(w)||R.includes(w)});return e.React.createElement(j,{style:{flex:1}},e.React.createElement(b,{title:"General Settings"},e.React.createElement(g,{label:"Enable Nicknames",subLabel:"Toggle all nickname functionality",trailing:e.React.createElement(S,{value:t.storage.settings.enabled,onValueChange:function(a){t.storage.settings.enabled=a}})}),e.React.createElement(g,{label:"Override Server Nicknames",subLabel:"Use custom nicknames instead of server ones",trailing:e.React.createElement(S,{value:t.storage.settings.overrideServerNicks,onValueChange:function(a){t.storage.settings.overrideServerNicks=a,a&&!h&&T()}})})),e.React.createElement(C,null),e.React.createElement(b,{title:"Display Options"},e.React.createElement(g,{label:"Show Prefix/Suffix",subLabel:"Add decorative text around nicknames",trailing:e.React.createElement(S,{value:t.storage.settings.showPrefix,onValueChange:function(a){t.storage.settings.showPrefix=a}})}),t.storage.settings.showPrefix&&e.React.createElement(F,{label:"Prefix",placeholder:"[",value:t.storage.settings.prefix,onChange:function(a){t.storage.settings.prefix=a}}),t.storage.settings.showPrefix&&e.React.createElement(F,{label:"Suffix",placeholder:"]",value:t.storage.settings.suffix,onChange:function(a){t.storage.settings.suffix=a}}),t.storage.settings.showPrefix&&e.React.createElement(y,{style:{padding:16,backgroundColor:"#2b2d31",marginHorizontal:16,marginTop:8,borderRadius:8}},e.React.createElement(m,{style:{color:"#b5bac1",fontSize:13}},`Preview: ${t.storage.settings.prefix}YourNickname${t.storage.settings.suffix}`))),e.React.createElement(C,null),e.React.createElement(b,{title:`Saved Nicknames (${Object.keys(t.storage.nicknames).length})`},e.React.createElement(z,null,"Long-press any user to set a nickname"),e.React.createElement(y,{style:{padding:16}},e.React.createElement(M,{placeholder:"Search nicknames...",placeholderTextColor:"#666",value:n,onChangeText:s,style:{backgroundColor:"#1e1f22",color:"#fff",padding:12,borderRadius:8,marginBottom:12}}),v.length===0?e.React.createElement(y,{style:{padding:20,alignItems:"center"}},e.React.createElement(m,{style:{color:"#888",textAlign:"center"}},n?"No nicknames found":"No nicknames saved yet")):v.map(function([a,i]){return e.React.createElement(y,{key:a,style:{backgroundColor:"#2b2d31",padding:12,borderRadius:8,marginBottom:8}},e.React.createElement(m,{style:{color:"#fff",fontWeight:"bold",marginBottom:4}},i),e.React.createElement(m,{style:{color:"#888",fontSize:12,marginBottom:8}},l(a)),e.React.createElement(y,{style:{flexDirection:"row",gap:8}},e.React.createElement(O,{style:{backgroundColor:"#5865f2",padding:8,borderRadius:6,flex:1},onPress:function(){return B(a,l(a))}},e.React.createElement(m,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:"600"}},"Edit")),e.React.createElement(O,{style:{backgroundColor:"#ed4245",padding:8,borderRadius:6,flex:1},onPress:function(){U(a,""),f("Nickname removed")}},e.React.createElement(m,{style:{color:"#fff",textAlign:"center",fontSize:12,fontWeight:"600"}},"Delete"))))}))),e.React.createElement(C,null),e.React.createElement(b,{title:"Data Management"},e.React.createElement(g,{label:"Export Nicknames",subLabel:"Copy to clipboard as JSON",leading:e.React.createElement(g.Icon,{source:p.getAssetIDByName("ic_download_24px")}),onPress:function(){const a=JSON.stringify(t.storage.nicknames,null,2);e.ReactNative.Clipboard?.setString(a),f(`Exported ${Object.keys(t.storage.nicknames).length} nicknames`)}}),e.React.createElement(g,{label:"Import Nicknames",subLabel:"Paste JSON from clipboard",leading:e.React.createElement(g.Icon,{source:p.getAssetIDByName("ic_upload_24px")}),onPress:async function(){try{const a=await e.ReactNative.Clipboard?.getString();if(!a){f("Clipboard is empty",2);return}const i=JSON.parse(a);Object.assign(t.storage.nicknames,i),f(`Imported ${Object.keys(i).length} nicknames`)}catch{f("Invalid JSON format",2)}}}),e.React.createElement(g,{label:"Clear All Nicknames",subLabel:"Delete all saved nicknames",leading:e.React.createElement(g.Icon,{source:p.getAssetIDByName("ic_message_delete")}),onPress:function(){D.showConfirmationAlert({title:"Clear All Nicknames?",content:`Delete all ${Object.keys(t.storage.nicknames).length} saved nicknames?`,confirmText:"Delete All",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){const a=Object.keys(t.storage.nicknames).length;t.storage.nicknames={},f(`Cleared ${a} nicknames`)}})}})),e.React.createElement(y,{style:{padding:16,marginBottom:20}},e.React.createElement(m,{style:{color:"#b5bac1",fontSize:12,textAlign:"center",lineHeight:18}},`Nicknames Everywhere v1.0
Custom nicknames across all servers and DMs`)))}var W={onLoad:function(){try{V(),T(),J(),c.logger.log(`[NicknamesEverywhere] Loaded with ${Object.keys(t.storage.nicknames).length} nicknames`)}catch(r){c.logger.error("[NicknamesEverywhere] Load error:",r)}},onUnload:function(){o&&(N&&(o.getName=N,N=null),E&&(o.getDisplayName=E,E=null),o=null),d&&h&&(d.getNick=h,h=null,d=null),P.forEach(function(r){try{r()}catch(n){c.logger.error("[NicknamesEverywhere] Unpatch error:",n)}}),P=[],c.logger.log("[NicknamesEverywhere] Unloaded. All patches restored.")},settings:G};return x.default=W,Object.defineProperty(x,"__esModule",{value:!0}),x})({},vendetta,vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.alerts,vendetta.storage,vendetta.ui.assets,vendetta.ui.components);
