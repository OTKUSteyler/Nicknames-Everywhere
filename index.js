(function(E,i,m,a,e,T,p,v,B){"use strict";const{ScrollView:A,View:k,Text:g,TouchableOpacity:S,TextInput:O}=e.ReactNative,{FormRow:d,FormSwitch:w,FormInput:C,FormDivider:N,FormSection:b,FormText:D}=B.Forms;a.storage.nicknames||(a.storage.nicknames={}),a.storage.settings||(a.storage.settings={enabled:!0,showPrefix:!1,prefix:"[",suffix:"]",overrideServerNicks:!0});let u=[];function R(n){if(!a.storage.settings.enabled||!n)return null;const s=a.storage.nicknames[n];return s?a.storage.settings.showPrefix?a.storage.settings.prefix+s+a.storage.settings.suffix:s:null}function x(n,s){!s||s.trim()===""?delete a.storage.nicknames[n]:a.storage.nicknames[n]=s.trim()}function P(n,s){const l=a.storage.nicknames[n]||"";T.showInputAlert({title:"Set Custom Nickname",placeholder:s,initialValue:l,confirmText:"Save",cancelText:"Cancel",onConfirm:function(o){x(n,o);const c=i.findByProps("showToast");c?.showToast&&(o.trim()?c.showToast("Nickname saved",1):c.showToast("Nickname removed",1))}})}function I(){try{const n=i.findByProps("getUser","getCurrentUser");n?.getName&&u.push(m.after("getName",n,function(s,l){const o=s[0];if(o?.id){const c=R(o.id);if(c)return c}return l})),n?.getDisplayName&&u.push(m.after("getDisplayName",n,function(s,l){const o=s[0];if(o?.id){const c=R(o.id);if(c)return c}return l}))}catch(n){console.error("[NicknamesEverywhere] Error patching UserUtils:",n)}}function L(){try{const n=i.findByProps("getNick","getMember");n?.getNick&&a.storage.settings.overrideServerNicks&&u.push(m.after("getNick",n,function(s,l){const o=s[1];if(o){const c=R(o);if(c)return c}return l}))}catch(n){console.error("[NicknamesEverywhere] Error patching GuildMemberStore:",n)}}function U(){try{const n=[i.findByProps("openUserContextMenu"),i.findByProps("showUserActionSheet")].filter(Boolean);for(const s of n){const l=["getUserActions","getActions"];for(const o of l)if(typeof s[o]=="function")try{u.push(m.after(o,s,function(c,t){if(!Array.isArray(t))return t;const r=c[0]?.user||c[0];if(!r?.id)return t;const f=a.storage.nicknames[r.id],h=r.globalName||r.username||"User";return t.push({key:"set-nickname",label:f?"Edit Nickname":"Set Nickname",icon:"ic_edit",onPress:function(){return P(r.id,h)}}),f&&t.push({key:"remove-nickname",label:"Remove Nickname",icon:"ic_message_delete",destructive:!0,onPress:function(){x(r.id,"");const y=i.findByProps("showToast");y?.showToast&&y.showToast("Nickname removed",1)}}),t}))}catch{}}}catch(n){console.error("[NicknamesEverywhere] Error patching user actions:",n)}}function _(){p.useProxy(a.storage);const n=i.findByStoreName("UserStore"),[s,l]=e.React.useState(""),o=function(t){try{const r=n?.getUser(t);return r?`${r.username}`:t}catch{return t}},c=Object.entries(a.storage.nicknames).filter(function([t,r]){if(!s)return!0;const f=o(t).toLowerCase(),h=r.toLowerCase(),y=s.toLowerCase();return f.includes(y)||h.includes(y)});return e.React.createElement(A,{style:{flex:1}},e.React.createElement(b,{title:"General Settings"},e.React.createElement(d,{label:"Enable Nicknames",subLabel:"Toggle nickname functionality",trailing:e.React.createElement(w,{value:a.storage.settings.enabled,onValueChange:function(t){a.storage.settings.enabled=t}})}),e.React.createElement(d,{label:"Override Server Nicknames",subLabel:"Use custom nicknames instead of server ones",trailing:e.React.createElement(w,{value:a.storage.settings.overrideServerNicks,onValueChange:function(t){a.storage.settings.overrideServerNicks=t}})})),e.React.createElement(N,null),e.React.createElement(b,{title:"Display Options"},e.React.createElement(d,{label:"Show Prefix/Suffix",subLabel:"Add text around nicknames",trailing:e.React.createElement(w,{value:a.storage.settings.showPrefix,onValueChange:function(t){a.storage.settings.showPrefix=t}})}),a.storage.settings.showPrefix&&e.React.createElement(C,{label:"Prefix",placeholder:"[",value:a.storage.settings.prefix,onChange:function(t){a.storage.settings.prefix=t}}),a.storage.settings.showPrefix&&e.React.createElement(C,{label:"Suffix",placeholder:"]",value:a.storage.settings.suffix,onChange:function(t){a.storage.settings.suffix=t}})),e.React.createElement(N,null),e.React.createElement(b,{title:`Saved Nicknames (${Object.keys(a.storage.nicknames).length})`},e.React.createElement(D,null,"Long-press any user to set a nickname"),e.React.createElement(k,{style:{padding:16}},e.React.createElement(O,{placeholder:"Search nicknames...",placeholderTextColor:"#666",value:s,onChangeText:l,style:{backgroundColor:"#1e1f22",color:"#fff",padding:12,borderRadius:8,marginBottom:12}}),c.length===0?e.React.createElement(k,{style:{padding:20,alignItems:"center"}},e.React.createElement(g,{style:{color:"#888",textAlign:"center"}},s?"No nicknames found":"No nicknames saved yet")):c.map(function([t,r]){return e.React.createElement(k,{key:t,style:{backgroundColor:"#2b2d31",padding:12,borderRadius:8,marginBottom:8}},e.React.createElement(g,{style:{color:"#fff",fontWeight:"bold",marginBottom:4}},r),e.React.createElement(g,{style:{color:"#888",fontSize:12,marginBottom:8}},o(t)),e.React.createElement(k,{style:{flexDirection:"row",gap:8}},e.React.createElement(S,{style:{backgroundColor:"#5865f2",padding:8,borderRadius:6,flex:1},onPress:function(){return P(t,o(t))}},e.React.createElement(g,{style:{color:"#fff",textAlign:"center",fontSize:12}},"Edit")),e.React.createElement(S,{style:{backgroundColor:"#ed4245",padding:8,borderRadius:6,flex:1},onPress:function(){x(t,"");const f=i.findByProps("showToast");f?.showToast&&f.showToast("Nickname removed",1)}},e.React.createElement(g,{style:{color:"#fff",textAlign:"center",fontSize:12}},"Delete"))))}))),e.React.createElement(N,null),e.React.createElement(b,{title:"Data Management"},e.React.createElement(d,{label:"Export Nicknames",subLabel:"Copy to clipboard as JSON",leading:e.React.createElement(d.Icon,{source:v.getAssetIDByName("ic_download_24px")}),onPress:function(){const t=JSON.stringify(a.storage.nicknames,null,2);e.ReactNative.Clipboard?.setString(t);const r=i.findByProps("showToast");r?.showToast&&r.showToast(`Exported ${Object.keys(a.storage.nicknames).length} nicknames`,1)}}),e.React.createElement(d,{label:"Import Nicknames",subLabel:"Paste JSON from clipboard",leading:e.React.createElement(d.Icon,{source:v.getAssetIDByName("ic_upload_24px")}),onPress:async function(){try{const t=await e.ReactNative.Clipboard?.getString();if(!t){const h=i.findByProps("showToast");h?.showToast&&h.showToast("Clipboard is empty",2);return}const r=JSON.parse(t);Object.assign(a.storage.nicknames,r);const f=i.findByProps("showToast");f?.showToast&&f.showToast(`Imported ${Object.keys(r).length} nicknames`,1)}catch{const t=i.findByProps("showToast");t?.showToast&&t.showToast("Invalid JSON format",2)}}}),e.React.createElement(d,{label:"Clear All Nicknames",subLabel:"Delete all saved nicknames",leading:e.React.createElement(d.Icon,{source:v.getAssetIDByName("ic_message_delete")}),onPress:function(){T.showConfirmationAlert({title:"Clear All Nicknames?",content:`Delete all ${Object.keys(a.storage.nicknames).length} saved nicknames?`,confirmText:"Delete All",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){const t=Object.keys(a.storage.nicknames).length;a.storage.nicknames={};const r=i.findByProps("showToast");r?.showToast&&r.showToast(`Cleared ${t} nicknames`,1)}})}})),e.React.createElement(k,{style:{padding:16,marginBottom:20}},e.React.createElement(g,{style:{color:"#b5bac1",fontSize:12,textAlign:"center"}},"Nicknames Everywhere v1.0")))}var j={onLoad:function(){try{I(),L(),U(),console.log(`[NicknamesEverywhere] Loaded with ${Object.keys(a.storage.nicknames).length} nicknames`)}catch(n){console.error("[NicknamesEverywhere] Load error:",n)}},onUnload:function(){u.forEach(function(n){try{n()}catch{}}),u=[],console.log("[NicknamesEverywhere] Unloaded")},settings:_};return E.default=j,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.alerts,vendetta.storage,vendetta.ui.assets,vendetta.ui.components);
