(function(p,a,h,f,b,k){"use strict";f.storage.nicknames||(f.storage.nicknames={});let u=[];function d(e){return f.storage.nicknames[e]||null}function g(e,o){!o||o.trim()===""?delete f.storage.nicknames[e]:f.storage.nicknames[e]=o.trim()}function N(e,o){const s=d(e);k.showInputAlert({title:"Set Custom Nickname",placeholder:o,initialValue:s||"",confirmText:"Save",cancelText:"Cancel",onConfirm:function(t){g(e,t);const{showToast:n}=a.findByProps("showToast")||{};n&&(t.trim()?n(`Nickname set to "${t}"`,1):n("Nickname removed",1))}})}function v(){const e=["Username","UserName","DisplayName","MemberListItem","MessageHeader","UserMention"];for(const o of e)try{const s=a.findByName(o,!1);if(s){const t=h.after("type",s,function(n,r){try{const c=n[0],m=c?.user?.id||c?.userId||c?.author?.id;if(m){const l=d(m);l&&r?.props&&(typeof r.props.children=="string"?r.props.children=l:r.props.children?.props?.children&&typeof r.props.children.props.children=="string"&&(r.props.children.props.children=l))}}catch{}return r});u.push(t),console.log(`[NicknamesEverywhere] Patched ${o}`)}}catch{}}function E(){try{const e=a.findByProps("getUser","getCurrentUser",!1);if(e?.getName){const o=h.after("getName",e,function(s,t){const n=s[0];if(n?.id){const r=d(n.id);if(r)return r}return t});u.push(o),console.log("[NicknamesEverywhere] Patched UserUtils.getName")}if(e?.getDisplayName){const o=h.after("getDisplayName",e,function(s,t){const n=s[0];if(n?.id){const r=d(n.id);if(r)return r}return t});u.push(o),console.log("[NicknamesEverywhere] Patched UserUtils.getDisplayName")}}catch(e){console.error("[NicknamesEverywhere] Error patching UserUtils:",e)}}function w(){try{const e=a.findByProps("getNick","getMember",!1);if(e?.getNick){const o=h.after("getNick",e,function(s,t){const[n,r]=s;if(r){const c=d(r);if(c)return c}return t});u.push(o),console.log("[NicknamesEverywhere] Patched GuildMemberStore.getNick")}}catch(e){console.error("[NicknamesEverywhere] Error patching GuildMemberStore:",e)}}function U(){try{const e=a.findByProps("openUserContextMenu",!1)||a.findByProps("showUserProfileActionSheet",!1);if(!e){console.warn("[NicknamesEverywhere] Could not find UserActions module");return}if(e.getUserActions||e.buildActions||e.default){const o=h.after("getUserActions",e,function(s,t){const n=s[0]?.user||s[0];if(n?.id&&Array.isArray(t)){const r=d(n.id);t.push({key:"set-nickname",label:r?"\u270F\uFE0F Edit Nickname":"\u270F\uFE0F Set Nickname",onPress:function(){const c=n.globalName||n.username||"User";N(n.id,c)}}),r&&t.push({key:"remove-nickname",label:"\u{1F5D1}\uFE0F Remove Nickname",onPress:function(){g(n.id,"");const{showToast:c}=a.findByProps("showToast")||{};c&&c("Nickname removed",1)}})}return t});u.push(o),console.log("[NicknamesEverywhere] Patched user context menu")}}catch(e){console.error("[NicknamesEverywhere] Error patching user context menu:",e)}}function P(){try{const e=a.findByName("MessageHeader",!1)||a.findByProps("MessageHeader",!1)?.MessageHeader;if(e){const o=e.default||e,s=h.after("type",o,function(t,n){try{const r=t[0],c=r?.message?.author?.id||r?.author?.id;if(c&&n?.props){const m=d(c);if(m){const l=function(i){if(!i)return i;if(typeof i=="string"){const y=r?.message?.author?.username||r?.author?.username;if(y&&i.includes(y))return i.replace(y,m)}return i?.props?.children&&(Array.isArray(i.props.children)?i.props.children=i.props.children.map(l):i.props.children=l(i.props.children)),i};n=l(n)}}}catch{}return n});u.push(s),console.log("[NicknamesEverywhere] Patched MessageHeader")}}catch(e){console.error("[NicknamesEverywhere] Error patching messages:",e)}}var M={onLoad:function(){try{E(),w(),v(),P(),U(),console.log(`[NicknamesEverywhere] Loaded with ${Object.keys(f.storage.nicknames).length} saved nicknames`),console.log(`[NicknamesEverywhere] Applied ${u.length} patches`)}catch(e){console.error("[NicknamesEverywhere] Failed to load:",e)}},onUnload:function(){u.forEach(function(e){try{e()}catch(o){console.error("[NicknamesEverywhere] Error during unpatch:",o)}}),u=[],console.log("[NicknamesEverywhere] Unloaded")}};return p.default=M,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.alerts);
